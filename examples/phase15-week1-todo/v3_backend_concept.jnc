// Phase 15, Week 1: Todo App - Version 3 (Backend Concept)
// Demonstrates: How @persist("backend") WOULD work
// Status: Conceptual - shows the pattern for future implementation
//
// This file shows what the code will look like when we fully integrate
// jounce-auth and jounce-db packages. For now, v1 and v2 are working examples.

// ============================================================================
// FUTURE: Server-side functions (when packages are integrated)
// ============================================================================

/*
server fn loadTodos(userId: String) -> Vec<Todo> {
    // Connect to database
    let db = Database.connect("sqlite://todos.db");

    // Query user's todos
    let todos = db.query(
        "SELECT id, text, completed FROM todos WHERE user_id = ?",
        [userId]
    );

    return todos;
}

server fn saveTodo(userId: String, text: String) -> Todo {
    let db = Database.connect("sqlite://todos.db");
    let id = Crypto.uuid_v4();

    db.execute(
        "INSERT INTO todos (id, user_id, text, completed) VALUES (?, ?, ?, false)",
        [id, userId, text]
    );

    return Todo { id: id, text: text, completed: false };
}

server fn updateTodo(userId: String, id: String, completed: bool) -> bool {
    let db = Database.connect("sqlite://todos.db");

    db.execute(
        "UPDATE todos SET completed = ? WHERE id = ? AND user_id = ?",
        [completed, id, userId]
    );

    return true;
}

server fn deleteTodo(userId: String, id: String) -> bool {
    let db = Database.connect("sqlite://todos.db");

    db.execute(
        "DELETE FROM todos WHERE id = ? AND user_id = ?",
        [id, userId]
    );

    return true;
}
*/

// ============================================================================
// CLIENT-SIDE: The Magic of @persist("backend")
// ============================================================================

style {
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 700px;
        width: 100%;
    }

    .title {
        font-size: 32px;
        color: #333;
        margin-bottom: 10px;
        font-weight: 700;
        text-align: center;
    }

    .subtitle {
        text-align: center;
        color: #3b82f6;
        font-size: 14px;
        margin-bottom: 30px;
        font-weight: 600;
    }

    .badge {
        background: #3b82f6;
        color: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
    }

    .code-block {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 10px;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 14px;
        margin: 20px 0;
        overflow-x: auto;
    }

    .keyword {
        color: #569cd6;
    }

    .string {
        color: #ce9178;
    }

    .comment {
        color: #6a9955;
    }

    .function {
        color: #dcdcaa;
    }

    .feature-list {
        list-style: none;
        padding: 0;
    }

    .feature-item {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }

    .check {
        color: #10b981;
        font-size: 20px;
        margin-right: 15px;
    }

    .comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }

    .compare-box {
        padding: 20px;
        border-radius: 10px;
    }

    .compare-before {
        background: #fee;
        border: 2px solid #fcc;
    }

    .compare-after {
        background: #efe;
        border: 2px solid #cfc;
    }

    .box-title {
        font-weight: 700;
        margin-bottom: 10px;
    }
}

fn BackendConcept() -> JSX {
    return (
        <div class="container">
            <h1 class="title">
                Todo App v3
                <span class="badge">ğŸ” Backend</span>
            </h1>
            <p class="subtitle">Conceptual: Shows the @persist("backend") pattern</p>

            <h2>ğŸ¯ The Progression</h2>

            <div class="comparison">
                <div class="compare-box compare-before">
                    <div class="box-title">âŒ v1: No Persistence</div>
                    <code>let todos = signal([]);</code>
                </div>

                <div class="compare-box compare-after">
                    <div class="box-title">âœ… v2: localStorage</div>
                    <code>@persist("localStorage")<br/>let todos = signal([]);</code>
                </div>
            </div>

            <div class="compare-box compare-after">
                <div class="box-title">ğŸš€ v3: Backend (Change ONE WORD!)</div>
                <div class="code-block">
                    <span class="comment">// Just change localStorage â†’ backend!</span><br/>
                    <span class="keyword">@persist</span>(<span class="string">"backend"</span>)<br/>
                    <span class="keyword">let</span> <span class="function">todos</span> = signal([]);
                </div>
            </div>

            <h2>âœ¨ What @persist("backend") Does Automatically:</h2>

            <ul class="feature-list">
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Calls <code>loadTodos(userId)</code> on startup
                </li>
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Calls <code>saveTodo(userId, text)</code> when adding
                </li>
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Calls <code>updateTodo(userId, id, done)</code> when toggling
                </li>
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Calls <code>deleteTodo(userId, id)</code> when deleting
                </li>
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Handles authentication tokens automatically
                </li>
                <li class="feature-item">
                    <span class="check">âœ“</span>
                    Syncs data across all devices
                </li>
            </ul>

            <h2>ğŸ“Š Feature Comparison</h2>

            <table style="width: 100%; margin: 20px 0; border-collapse: collapse;">
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; text-align: left;">Feature</th>
                    <th style="padding: 10px;">v1</th>
                    <th style="padding: 10px;">v2</th>
                    <th style="padding: 10px;">v3</th>
                </tr>
                <tr>
                    <td style="padding: 10px;">Add/Edit/Delete</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 10px;">Survives Refresh</td>
                    <td style="padding: 10px; text-align: center;">âŒ</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Multi-device Sync</td>
                    <td style="padding: 10px; text-align: center;">âŒ</td>
                    <td style="padding: 10px; text-align: center;">âŒ</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 10px;">Multi-user</td>
                    <td style="padding: 10px; text-align: center;">âŒ</td>
                    <td style="padding: 10px; text-align: center;">âŒ</td>
                    <td style="padding: 10px; text-align: center;">âœ…</td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Lines of Code</td>
                    <td style="padding: 10px; text-align: center;">50</td>
                    <td style="padding: 10px; text-align: center;">52</td>
                    <td style="padding: 10px; text-align: center;">52*</td>
                </tr>
            </table>

            <p style="margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 10px; font-size: 14px;">
                <strong>* Note:</strong> Client code stays at 52 lines! Server functions are separate.
                <br/>The @persist decorator handles all the complexity automatically.
            </p>

            <h2>ğŸš€ Coming Soon</h2>
            <p>Full v3 implementation when jounce-auth and jounce-db are integrated!</p>
        </div>
    );
}

fn main() {
    console.log("ğŸ“ Todo App v3 (Backend Concept)");
    console.log("ğŸ¯ Shows the @persist(\"backend\") pattern");
    console.log("âœ… v1 and v2 are working examples!");
}
